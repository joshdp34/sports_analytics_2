<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>STA 3311 Sports Analytics II - 10&nbsp; Random Forests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11_Spatial.html" rel="next">
<link href="./09_ML.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="webex.css">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_Random.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Forests</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Intro to Data Manipulation with <code>dplyr</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_Stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">String, Dates, and Joins</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_Tidymodels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Tidymodels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear Regression with Regularization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_Logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logistic Regression with Regularization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_Mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mixed Effects Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Obtaining Sport Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_Web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Web Scraping with Rvest</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_ML.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introduction to Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_Random.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Forests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_Spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualization of Player Tracking Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_knn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">K-Nearest Neighbors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_dimension.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Dimensionality Reduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_SVM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_DBSCAN.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">DBSCAN</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_MLP.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Multi-Layer Perceptron</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_Fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Fitting and Overfitting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_Rankings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Intro to Rankings</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#introduction-to-decision-trees" id="toc-introduction-to-decision-trees" class="nav-link active" data-scroll-target="#introduction-to-decision-trees"><span class="header-section-number">10.1</span> Introduction to Decision Trees</a>
  <ul class="collapse">
<li><a href="#why-decision-trees-in-sports-analytics" id="toc-why-decision-trees-in-sports-analytics" class="nav-link" data-scroll-target="#why-decision-trees-in-sports-analytics"><span class="header-section-number">10.1.1</span> Why Decision Trees in Sports Analytics?</a></li>
  <li><a href="#example-predicting-nba-game-wins" id="toc-example-predicting-nba-game-wins" class="nav-link" data-scroll-target="#example-predicting-nba-game-wins"><span class="header-section-number">10.1.2</span> Example: Predicting NBA Game Wins</a></li>
  <li><a href="#how-decision-trees-make-splits" id="toc-how-decision-trees-make-splits" class="nav-link" data-scroll-target="#how-decision-trees-make-splits"><span class="header-section-number">10.1.3</span> How Decision Trees Make Splits</a></li>
  <li><a href="#example-with-more-predictors" id="toc-example-with-more-predictors" class="nav-link" data-scroll-target="#example-with-more-predictors"><span class="header-section-number">10.1.4</span> Example with more predictors</a></li>
  <li><a href="#decision-tree-hyperparameters" id="toc-decision-tree-hyperparameters" class="nav-link" data-scroll-target="#decision-tree-hyperparameters"><span class="header-section-number">10.1.5</span> Decision Tree Hyperparameters</a></li>
  </ul>
</li>
  <li>
<a href="#ensemble-learning-concept-and-motivation" id="toc-ensemble-learning-concept-and-motivation" class="nav-link" data-scroll-target="#ensemble-learning-concept-and-motivation"><span class="header-section-number">10.2</span> Ensemble Learning: Concept and Motivation</a>
  <ul class="collapse">
<li><a href="#bias-variance-trade-off" id="toc-bias-variance-trade-off" class="nav-link" data-scroll-target="#bias-variance-trade-off"><span class="header-section-number">10.2.1</span> Bias-Variance Trade-off</a></li>
  <li><a href="#voting-classifiers" id="toc-voting-classifiers" class="nav-link" data-scroll-target="#voting-classifiers"><span class="header-section-number">10.2.2</span> Voting Classifiers</a></li>
  <li><a href="#baggin-and-pasting" id="toc-baggin-and-pasting" class="nav-link" data-scroll-target="#baggin-and-pasting"><span class="header-section-number">10.2.3</span> Baggin and Pasting</a></li>
  </ul>
</li>
  <li>
<a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="header-section-number">10.3</span> Random Forests</a>
  <ul class="collapse">
<li><a href="#how-do-random-forests-work" id="toc-how-do-random-forests-work" class="nav-link" data-scroll-target="#how-do-random-forests-work"><span class="header-section-number">10.3.1</span> How Do Random Forests Work?</a></li>
  <li><a href="#example-predicting-nba-game-outcomes-with-random-forests" id="toc-example-predicting-nba-game-outcomes-with-random-forests" class="nav-link" data-scroll-target="#example-predicting-nba-game-outcomes-with-random-forests"><span class="header-section-number">10.3.2</span> Example: Predicting NBA Game Outcomes with Random Forests</a></li>
  <li><a href="#evaluating-the-random-forest-model" id="toc-evaluating-the-random-forest-model" class="nav-link" data-scroll-target="#evaluating-the-random-forest-model"><span class="header-section-number">10.3.3</span> Evaluating the Random Forest Model</a></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning"><span class="header-section-number">10.3.4</span> Hyperparameter tuning</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">10.3.5</span> Variable Importance</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">10.3.6</span> Summary</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Random Forests</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><blockquote class="blockquote">
<p>“Talent is God given. Be humble. Fame is man-given. Be grateful. Conceit is self-given. Be careful.” - John Wooden</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="pics/wooden.png" class="img-fluid figure-img" width="200"></p>
<figcaption class="figure-caption">UCLA head coach John Wooden celebrates with Lew Alcindor (left) and Sidney Wicks (right). UCLA defeated Purdue on March 24, 1969, to win the NCAA title for the third year in a row.</figcaption></figure>
</div>
<section id="introduction-to-decision-trees" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="introduction-to-decision-trees">
<span class="header-section-number">10.1</span> Introduction to Decision Trees</h2>
<p>A <strong>decision tree</strong> is a powerful supervised learning algorithm widely used in sports analytics for both classification and regression problems. A decision tree partitions the data into subsets based on simple decision rules inferred from the predictor variables. It constructs a flowchart-like structure, where each internal node represents a condition on a predictor variable, branches represent outcomes of those conditions, and leaf nodes represent predictions or classifications.</p>
<p>Decision trees provide intuitive interpretations, making them particularly appealing for sports analysts who value explainability alongside predictive accuracy.</p>
<section id="why-decision-trees-in-sports-analytics" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="why-decision-trees-in-sports-analytics">
<span class="header-section-number">10.1.1</span> Why Decision Trees in Sports Analytics?</h3>
<p>Decision trees are particularly useful for:</p>
<ul>
<li>Predicting categorical outcomes, such as win/loss scenarios in matches.</li>
<li>Forecasting continuous performance measures, like points scored or yards gained.</li>
<li>Identifying key variables that influence performance outcomes.</li>
</ul></section><section id="example-predicting-nba-game-wins" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="example-predicting-nba-game-wins">
<span class="header-section-number">10.1.2</span> Example: Predicting NBA Game Wins</h3>
<p>Consider data from the <strong>hoopR</strong> library, which provides comprehensive basketball statistics. Suppose we aim to predict whether a player successfully makes a free throw based on game context and player characteristics.</p>
<p>Using the <strong>tidymodels</strong> framework, we first prepare and split our dataset:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sportsdataverse/hoopR">hoopR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">game_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hoopR.sportsdataverse.org/reference/load_nba_team_box.html">load_nba_team_box</a></span><span class="op">(</span>seasons <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">team_winner</span>, <span class="st">"W"</span>, <span class="st">"L"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"L"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         largest_lead <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">largest_lead</span><span class="op">)</span>,</span>
<span>         fast_break_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">fast_break_points</span><span class="op">)</span>,</span>
<span>         points_in_paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">points_in_paint</span><span class="op">)</span>,</span>
<span>         is_home <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">team_home_away</span><span class="op">==</span><span class="st">"home"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">is_home</span>, <span class="va">team_score</span>, <span class="va">assists</span>, <span class="va">blocks</span>,</span>
<span>         <span class="va">defensive_rebounds</span>,<span class="va">fast_break_points</span>, <span class="va">field_goal_pct</span>, </span>
<span>         <span class="va">flagrant_fouls</span>, <span class="va">fouls</span>, </span>
<span>         <span class="va">free_throw_pct</span>, <span class="va">largest_lead</span>,</span>
<span>         <span class="va">offensive_rebounds</span>, <span class="va">points_in_paint</span>, <span class="va">steals</span>, </span>
<span>         <span class="va">team_turnovers</span>, <span class="va">technical_fouls</span>, </span>
<span>         <span class="va">three_point_field_goal_pct</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1004</span><span class="op">)</span></span>
<span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">game_data</span>, prop <span class="op">=</span> <span class="fl">0.8</span>, strata <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we define and fit a simple decision tree model using <strong>parsnip</strong>. Let’s just use one predictor: <code>team_score</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tree_spec</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_fit</span> <span class="op">&lt;-</span> <span class="va">tree_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">team_score</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_fit</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object

n= 2104 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

1) root 2104 1052 W (0.5000000 0.5000000)  
  2) team_score&gt;=111.5 1243  392 W (0.6846340 0.3153660) *
  3) team_score&lt; 111.5 861  201 L (0.2334495 0.7665505) *</code></pre>
</div>
</div>
<p>We visualize the fitted tree to interpret decisions clearly:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.org/rpart-plot/index.html">rpart.plot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_fit</span><span class="op">$</span><span class="va">fit</span>, extra<span class="op">=</span><span class="fl">104</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section><section id="how-decision-trees-make-splits" class="level3" data-number="10.1.3"><h3 data-number="10.1.3" class="anchored" data-anchor-id="how-decision-trees-make-splits">
<span class="header-section-number">10.1.3</span> How Decision Trees Make Splits</h3>
<p>Decision trees grow by repeatedly splitting data into two or more homogenous subsets based on the predictor variables. To illustrate the concept, consider our simplified basketball example, where we predict game outcome (<code>result</code>: Win or Loss) based solely on <code>team_score</code>.</p>
<p>The splitting procedure involves three fundamental steps:</p>
<ol type="1">
<li><strong>Considering Potential Splits:</strong></li>
</ol>
<p>The algorithm examines each possible split point within the predictor variable (in this case, <code>team_score</code>) to separate the observations into two subsets.</p>
<ol start="2" type="1">
<li><strong>Evaluating Split Quality (Purity):</strong></li>
</ol>
<p>For classification trees, the goal is to maximize <strong>purity</strong> within resulting groups—ideally, each subset would contain observations predominantly from one category (either mostly wins or mostly losses). A commonly used measure of purity is the <strong>Gini index</strong>, defined as:</p>
<p><span class="math display">\[
\text{Gini index} = 1 - \sum_{i=1}^{k} p_i^2
\]</span></p>
<p>where <span class="math inline">\(p_i\)</span> is the proportion of observations in category <span class="math inline">\(i\)</span>, and <span class="math inline">\(k\)</span> is the number of classes (here, <span class="math inline">\(k=2\)</span>: Win or Loss). Lower Gini index values indicate higher purity and thus better splits.</p>
<ol start="3" type="1">
<li><strong>Choosing the Best Split:</strong></li>
</ol>
<p>The algorithm chooses the split point that minimizes impurity (or equivalently, maximizes purity). In the basketball data, the algorithm found that splitting at a certain team score (for example, 112 points) best separated winning games from losing ones. Games with scores above this cutoff mostly resulted in wins, while those below mostly ended in losses.</p>
<p>These steps repeat recursively, with each resulting subset further split until stopping conditions (such as minimum node size or improvement thresholds) are met. The final leaves represent predicted classes based on majority votes of training observations within each leaf.</p>
<p>The visualization from <code><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot()</a></code> neatly illustrates this process. The top node indicates the overall dataset, split at the selected threshold (<code>team_score</code>). Subsequent branches represent outcomes based on this split, clearly showing how higher team scores are associated with wins.</p>
<p>Decision trees thus provide clear, interpretable decision rules directly linked to your data, helping sports analysts easily communicate insights from predictive models.</p>
</section><section id="example-with-more-predictors" class="level3" data-number="10.1.4"><h3 data-number="10.1.4" class="anchored" data-anchor-id="example-with-more-predictors">
<span class="header-section-number">10.1.4</span> Example with more predictors</h3>
<p>Let’s return to our example and include two more predictors: `</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tree_spec</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_fit</span> <span class="op">&lt;-</span> <span class="va">tree_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">team_score</span> <span class="op">+</span> <span class="va">field_goal_pct</span> <span class="op">+</span> <span class="va">defensive_rebounds</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_fit</span><span class="op">$</span><span class="va">fit</span>, extra <span class="op">=</span> <span class="fl">104</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>We can evaluate the fit of this tree by examining accuracy and the confusion matrix as we did in logistic regression. In the case of binary categories, such as in our example, we can also do a ROC curve.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs</span>, <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.747</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   W   L
         W 723 203
         L 329 849</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.770</code></pre>
</div>
</div>
<p>Now, we will check the test data:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs_test</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds_test</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs_test</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.692</code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   W   L
         W 163  62
         L 100 201</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.721</code></pre>
</div>
</div>
<p>Note that both the accuracy and AUC are lower by about 0.05 for the test data than they were for the train data. This indicates some overfitting in the decision tree.</p>
</section><section id="decision-tree-hyperparameters" class="level3" data-number="10.1.5"><h3 data-number="10.1.5" class="anchored" data-anchor-id="decision-tree-hyperparameters">
<span class="header-section-number">10.1.5</span> Decision Tree Hyperparameters</h3>
<p>The two hyperparameters in a decision tree are</p>
<ul>
<li>’tree_depth`: the maximum depth of the tree</li>
<li>‘min_n’: the minimum number of data points in a node that are required for the node to be split further.</li>
</ul>
<p>As we have done in the past, we will tune these hyperparameters. Let’s do so with our example and include all 17 possible features (predictor variables).</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tree_model</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span>tree_depth <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                            min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#setup tuning grid</span></span>
<span><span class="va">tuning_grid</span> <span class="op">=</span> <span class="fu">grid_regular</span><span class="op">(</span></span>
<span>  <span class="fu">tree_depth</span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">min_n</span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  levels <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#setup cross validation</span></span>
<span><span class="va">dat_folds</span> <span class="op">=</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">train_data</span>, v <span class="op">=</span> <span class="fl">5</span>, strata <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#tune the model</span></span>
<span><span class="va">tree_results</span> <span class="op">=</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">tree_model</span>,</span>
<span>  <span class="va">result</span><span class="op">~</span><span class="va">.</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">dat_folds</span>,</span>
<span>  grid <span class="op">=</span> <span class="va">tuning_grid</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_params</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">tree_results</span>, metric<span class="op">=</span><span class="st">"accuracy"</span><span class="op">)</span></span>
<span><span class="va">best_params</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  tree_depth min_n .config               
       &lt;int&gt; &lt;int&gt; &lt;chr&gt;                 
1          4     2 Preprocessor1_Model004</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tree_spec</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span>tree_depth <span class="op">=</span> <span class="va">best_params</span><span class="op">$</span><span class="va">tree_depth</span>,</span>
<span>                           min_n <span class="op">=</span> <span class="va">best_params</span><span class="op">$</span><span class="va">min_n</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_fit</span> <span class="op">&lt;-</span> <span class="va">tree_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/rpart.plot/man/rpart.plot.html">rpart.plot</a></span><span class="op">(</span><span class="va">tree_fit</span><span class="op">$</span><span class="va">fit</span>, extra <span class="op">=</span> <span class="fl">104</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs</span>, <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.846</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   W   L
         W 888 159
         L 164 893</code></pre>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.899</code></pre>
</div>
</div>
<p>Checking the test data:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs_test</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds_test</span> <span class="op">=</span> <span class="va">tree_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs_test</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.772</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   W   L
         W 194  51
         L  69 212</code></pre>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.848</code></pre>
</div>
</div>
</section></section><section id="ensemble-learning-concept-and-motivation" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="ensemble-learning-concept-and-motivation">
<span class="header-section-number">10.2</span> Ensemble Learning: Concept and Motivation</h2>
<p>While individual decision trees are intuitive and interpretable, they can be prone to high variance—small changes in training data can lead to significant differences in predictions. <strong>Ensemble learning</strong> methods mitigate this limitation by combining multiple predictive models to achieve better stability and predictive performance.</p>
<section id="bias-variance-trade-off" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="bias-variance-trade-off">
<span class="header-section-number">10.2.1</span> Bias-Variance Trade-off</h3>
<p>The bias-variance trade-off is a fundamental concept in machine learning that describes the tension between the error introduced by the model’s assumptions about the underlying data structure (bias) and the error introduced by sensitivity to fluctuations in the training set (variance). Understanding this trade-off is crucial for developing models that generalize well to unseen data.</p>
<section id="bias" class="level4"><h4 class="anchored" data-anchor-id="bias">Bias</h4>
<p>Bias refers to the error due to overly simplistic assumptions in the learning algorithm. High bias can cause the model to miss relevant relations between features and target outputs (underfitting), leading to poor performance on both the training and test data.</p>
</section><section id="variance" class="level4"><h4 class="anchored" data-anchor-id="variance">Variance</h4>
<p>Variance refers to the error due to too much complexity in the learning algorithm. High variance can cause the model to model the random noise in the training data (overfitting), leading to poor generalization to new data.</p>
</section><section id="trade-off" class="level4"><h4 class="anchored" data-anchor-id="trade-off">Trade-off</h4>
<p>Ideally, one wants to choose a model that both accurately captures the regularities in its training data and generalizes well to unseen data. However, in practice, there is often a tradeoff between bias and variance. Increasing a model’s complexity will typically decrease bias but increase variance. Conversely, reducing a model’s complexity increases its bias but decreases its variance. The goal is to find the right balance between bias and variance, minimizing the total error.</p>
</section><section id="example" class="level4"><h4 class="anchored" data-anchor-id="example">Example</h4>
<p>Let’s illustrate the bias-variance trade-off with a simple example in R. We will use polynomial regression to fit a model to synthetic data. This example demonstrates how increasing the polynomial degree (model complexity) affects the bias and variance of the model predictions.</p>
<p>First, we’ll generate some synthetic data that follows a sine curve with some added noise:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span>, length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">50</span>, sd<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Synthetic Sine Data with Noise"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Next, we’ll fit polynomial regression models of varying degrees to this data and visualize how model complexity influences the fit:</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Function to fit and predict using polynomial regression</span></span>
<span><span class="va">newdat</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">predict_poly</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">degree</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">degree</span>,</span>
<span>                       raw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">newdat</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">newdat</span>,</span>
<span>                   deg1 <span class="op">=</span> <span class="fu">predict_poly</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                   deg3 <span class="op">=</span> <span class="fu">predict_poly</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                   deg10 <span class="op">=</span> <span class="fu">predict_poly</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plotting the data and models of different degrees</span></span>
<span><span class="va">dat</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">deg1</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">deg3</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">deg10</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Polynomial Regression with Different Degrees"</span>, x<span class="op">=</span><span class="st">"X"</span>, y<span class="op">=</span><span class="st">"Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>In this example:</p>
<ul>
<li>A low-degree polynomial (blue line) may not capture the underlying trend well, exhibiting high bias and low variance.</li>
<li>A moderate-degree polynomial (red line) might strike a good balance, capturing the underlying trend while not being too sensitive to the noise in the data.</li>
<li>A high-degree polynomial (black line) might fit the training data very closely, capturing the noise as if it were a signal, thus exhibiting low bias but high variance.</li>
</ul>
<p>By adjusting the complexity of the model (in this case, the degree of the polynomial), we can observe the impact on bias and variance, illustrating the bias-variance trade-off. The key in practice is to find the complexity level that minimizes the total error on unseen data.</p>
</section></section><section id="voting-classifiers" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="voting-classifiers">
<span class="header-section-number">10.2.2</span> Voting Classifiers</h3>
<p>Imagine you’ve developed several classifiers, each achieving an accuracy of around 80%. A straightforward strategy to enhance classification performance is to combine the predictions from each of these classifiers and select the class that receives the most votes. This method, known as a <em>hard voting classifier</em>, can lead to a composite classifier that outperforms even the most accurate member of the ensemble.</p>
<p>Surprisingly, a voting classifier can achieve higher precision than any individual classifier in the group. This improvement in accuracy occurs even if each classifier performs only marginally better than chance. With a large and diverse set of such weak learners, the ensemble can become a strong learner, capable of high accuracy. How does this phenomenon occur? Consider the following analogy for clarity.</p>
<p>Imagine a coin that is slightly biased, with a 51% chance of landing heads and a 49% chance of landing tails. If you flip this coin 1,000 times, you’re likely to observe around 510 heads and 490 tails, leading to a majority of heads. Calculations reveal that the likelihood of seeing more heads than tails after 1,000 flips is about 75%. This probability increases with the number of flips, exceeding 97% after 10,000 flips. This outcome is a result of the law of large numbers, which posits that as the number of flips increases, the proportion of heads approaches the true likelihood of a head flip (51%).</p>
<p>We can visualize this by simulating a slightly biased coin in R.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n</span> <span class="op">=</span> <span class="fl">20000</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1004</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flips</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">.51</span><span class="op">)</span></span>
<span><span class="va">ratio_heads</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean</a></span><span class="op">(</span><span class="va">flips</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>flip <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">ratio_heads</span>, sim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">flips</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">.51</span><span class="op">)</span></span>
<span>  <span class="va">ratio_heads</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean</a></span><span class="op">(</span><span class="va">flips</span><span class="op">)</span></span>
<span>  <span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>flip <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">ratio_heads</span>, sim <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flip</span>, y <span class="op">=</span> <span class="va">ratio_heads</span>, group <span class="op">=</span> <span class="va">sim</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.51</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Proportion of Heads"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Number of Flips"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"20 Simulated series of flipping a biased coin 20,000 times"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Applying this principle to ensemble learning, consider an ensemble of 1,000 classifiers, each with a 51% chance of making the correct prediction (just above random chance). By aggregating their predictions and choosing the class with the majority vote, you might expect accuracy rates as high as 75%. This scenario assumes, however, that all classifiers make independent errors, an idealization not often met since the classifiers are trained on the same data and may make similar mistakes. Consequently, the likelihood of incorrect majority votes increases, potentially lowering the ensemble’s overall accuracy.</p>
<section id="soft-voting" class="level4"><h4 class="anchored" data-anchor-id="soft-voting">Soft Voting</h4>
<p>When your classifiers are capable of estimating class probabilities you can leverage a technique known as <em>soft voting</em>. Soft voting calculates the class with the highest average probability across all classifiers, potentially leading to more accurate ensemble predictions. This method can outperform hard voting because it assigns greater influence to predictions made with high confidence.</p>
</section></section><section id="baggin-and-pasting" class="level3" data-number="10.2.3"><h3 data-number="10.2.3" class="anchored" data-anchor-id="baggin-and-pasting">
<span class="header-section-number">10.2.3</span> Baggin and Pasting</h3>
<p>Achieving a diverse collection of classifiers can be accomplished in two primary ways: employing a variety of training algorithms or using a single algorithm but training it on distinct random subsets of the training data. The latter approach manifests in two techniques: <strong>bagging</strong> and <strong>pasting</strong>, based on how samples are drawn from the training set.</p>
<p>Bagging—short for bootstrap aggregating—involves drawing random subsets of the training set with replacement. That means the same training instance can appear multiple times in the same subset.</p>
<p>Pasting, on the other hand, draws subsets without replacement, ensuring that training instances don’t repeat within a subset.</p>
<p>The essence of both bagging and pasting is to permit each model in the ensemble to learn from a slightly different perspective of the data, thereby introducing diversity. While bagging allows the same data point to be used multiple times by the same predictor, pasting does not.</p>
<p>Once training is complete, the ensemble predicts new instances by aggregating the outcomes of all models. For classification tasks, this aggregation typically involves selecting the most common prediction (analogous to a hard voting classifier), whereas for regression tasks, the average prediction is used. Although each model may exhibit higher bias when trained on a subset of the training data, the aggregation process tends to decrease both bias and variance. The result is an ensemble that generally retains a similar bias but exhibits a lower variance compared to a model trained on the entire training set.</p>
<p>A significant advantage of bagging and pasting is their scalability. Since each model can be trained independently on a separate subset of data, the training process can be easily parallelized across multiple CPU cores or different servers. This parallelization extends to making predictions, making bagging and pasting highly efficient and popular for building scalable ensemble models.</p>
</section></section><section id="random-forests" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="random-forests">
<span class="header-section-number">10.3</span> Random Forests</h2>
<p>Random forests are a sophisticated extension of the bagging method, explicitly designed to improve the predictive power and stability of decision trees. Random forests combine predictions from a large number of individual decision trees, each trained on a bootstrap sample of the original data and using a random subset of predictor variables at each node split. This additional randomness helps reduce correlation between individual trees, resulting in a robust ensemble model with lower variance and improved generalization to unseen data.</p>
<section id="how-do-random-forests-work" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="how-do-random-forests-work">
<span class="header-section-number">10.3.1</span> How Do Random Forests Work?</h3>
<p>Random forests follow these primary steps:</p>
<ol type="1">
<li><p><strong>Bootstrap sampling</strong>: Similar to bagging, each tree is built on a bootstrap sample—randomly selected observations with replacement from the training set.</p></li>
<li><p><strong>Random Feature Selection</strong>: At each split within a decision tree, a random subset of predictor variables is selected. The best split is then chosen from these randomly selected predictors, adding diversity among the trees and reducing correlation among individual trees.</p></li>
<li><p><strong>Aggregation of Predictions</strong>: For classification, predictions from individual trees are aggregated through majority voting. For regression tasks, predictions are aggregated by averaging.</p></li>
</ol>
<p>Random forests thus achieve greater accuracy and reduce overfitting compared to single trees or bagging alone, making them a valuable tool in sports analytics.</p>
</section><section id="example-predicting-nba-game-outcomes-with-random-forests" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="example-predicting-nba-game-outcomes-with-random-forests">
<span class="header-section-number">10.3.2</span> Example: Predicting NBA Game Outcomes with Random Forests</h3>
<p>Returning to our basketball example, we aim to predict whether an NBA team wins (<code>result</code>) using data from the <strong>hoopR</strong> package. We employ the <strong>tidymodels</strong> framework to build and evaluate our random forest model.</p>
<p>First, load and preprocess the dataset:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sportsdataverse/hoopR">hoopR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">game_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hoopR.sportsdataverse.org/reference/load_nba_team_box.html">load_nba_team_box</a></span><span class="op">(</span>seasons <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">team_winner</span>, <span class="st">"W"</span>, <span class="st">"L"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"L"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         largest_lead <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">largest_lead</span><span class="op">)</span>,</span>
<span>         fast_break_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">fast_break_points</span><span class="op">)</span>,</span>
<span>         points_in_paint <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">points_in_paint</span><span class="op">)</span>,</span>
<span>         is_home <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">team_home_away</span><span class="op">==</span><span class="st">"home"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">is_home</span>, <span class="va">team_score</span>, <span class="va">assists</span>, <span class="va">blocks</span>,</span>
<span>         <span class="va">defensive_rebounds</span>, <span class="va">fast_break_points</span>, <span class="va">field_goal_pct</span>, </span>
<span>         <span class="va">fouls</span>, <span class="va">free_throw_pct</span>, <span class="va">largest_lead</span>,</span>
<span>         <span class="va">offensive_rebounds</span>, <span class="va">points_in_paint</span>, <span class="va">steals</span>, </span>
<span>         <span class="va">team_turnovers</span>, <span class="va">three_point_field_goal_pct</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1004</span><span class="op">)</span></span>
<span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">game_data</span>, prop <span class="op">=</span> <span class="fl">0.8</span>, strata <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now define a random forest model using <strong>parsnip</strong> with the <strong>ranger</strong> engine, known for efficiency and scalability:</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_fit</span> <span class="op">&lt;-</span> <span class="va">rf_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">probs</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs</span>, <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.982</code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction    W    L
         W 1033   18
         L   19 1034</code></pre>
</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.999</code></pre>
</div>
</div>
</section><section id="evaluating-the-random-forest-model" class="level3" data-number="10.3.3"><h3 data-number="10.3.3" class="anchored" data-anchor-id="evaluating-the-random-forest-model">
<span class="header-section-number">10.3.3</span> Evaluating the Random Forest Model</h3>
<p>We assess the performance of our random forest on the testing data using measures of accuracy, confusion matrix, and ROC-AUC:</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs_test</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds_test</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs_test</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.810</code></pre>
</div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   W   L
         W 203  40
         L  60 223</code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">roc_curve</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.885</code></pre>
</div>
</div>
<p>This random forest model is clearly overfit. We will need to fine tune the model as we did with a single decision tree.</p>
</section><section id="hyperparameter-tuning" class="level3" data-number="10.3.4"><h3 data-number="10.3.4" class="anchored" data-anchor-id="hyperparameter-tuning">
<span class="header-section-number">10.3.4</span> Hyperparameter tuning</h3>
<p>Random forests have several tunable hyperparameters, including:</p>
<ul>
<li>
<strong><code>mtry</code></strong>: Number of randomly selected predictors at each split.</li>
<li>
<strong><code>min_n</code></strong>: Minimum number of data points required to split a node.</li>
<li>
<strong><code>trees</code></strong>: Number of decision trees grown.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">500</span>, mtry<span class="op">=</span><span class="fu">tune</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                       min_n<span class="op">=</span><span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#setup tuning grid</span></span>
<span><span class="va">tuning_grid</span> <span class="op">=</span> <span class="fu">grid_regular</span><span class="op">(</span></span>
<span>  <span class="fu">mtry</span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">min_n</span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  levels <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#setup cross validation</span></span>
<span><span class="va">dat_folds</span> <span class="op">=</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">train_data</span>, v <span class="op">=</span> <span class="fl">5</span>, strata <span class="op">=</span> <span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#tune the model</span></span>
<span><span class="va">rf_results</span> <span class="op">=</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">rf_spec</span>,</span>
<span>  <span class="va">result</span><span class="op">~</span><span class="va">.</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">dat_folds</span>,</span>
<span>  grid <span class="op">=</span> <span class="va">tuning_grid</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">best_params</span> <span class="op">&lt;-</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">rf_results</span>, metric<span class="op">=</span><span class="st">"accuracy"</span><span class="op">)</span></span>
<span><span class="va">best_params</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
   mtry min_n .config              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
1    11    30 Preprocessor1_Model24</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">500</span>, mtry<span class="op">=</span><span class="va">best_params</span><span class="op">$</span><span class="va">mtry</span>,</span>
<span>                       min_n<span class="op">=</span><span class="va">best_params</span><span class="op">$</span><span class="va">min_n</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_fit</span> <span class="op">&lt;-</span> <span class="va">rf_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">probs</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">train_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs</span>, <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.940</code></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.988</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs_test</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span>, type<span class="op">=</span><span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds_test</span> <span class="op">=</span> <span class="va">rf_fit</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">probs_test</span>, <span class="va">test_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">accuracy</span><span class="op">(</span><span class="va">preds_test</span>, truth <span class="op">=</span> <span class="va">result</span>, estimate<span class="op">=</span><span class="va">.pred_class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.797</code></pre>
</div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">preds_test</span> <span class="op">|&gt;</span> <span class="fu">roc_auc</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">result</span>, <span class="va">.pred_W</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.881</code></pre>
</div>
</div>
<p>Although there is improvement, we still have overfitting.</p>
</section><section id="variable-importance" class="level3" data-number="10.3.5"><h3 data-number="10.3.5" class="anchored" data-anchor-id="variable-importance">
<span class="header-section-number">10.3.5</span> Variable Importance</h3>
<p>A powerful advantage of random forests is the built-in measure of <strong>variable importance</strong>. This measure identifies the predictors that contribute most significantly to the model’s predictive power, thus providing valuable insights to sports analysts.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/">vip</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">500</span>, mtry<span class="op">=</span><span class="va">best_params</span><span class="op">$</span><span class="va">mtry</span>,</span>
<span>                       min_n<span class="op">=</span><span class="va">best_params</span><span class="op">$</span><span class="va">min_n</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span>, importance<span class="op">=</span><span class="st">"impurity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_fit</span> <span class="op">&lt;-</span> <span class="va">rf_spec</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://koalaverse.github.io/vip/reference/vip.html">vip</a></span><span class="op">(</span><span class="va">rf_fit</span><span class="op">$</span><span class="va">fit</span>, num_features <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Variable Importance from Random Forest"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"NBA Game Outcome Prediction"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="10_Random_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>The resulting plot ranks predictors by their relative importance, guiding analysts toward factors most influential in determining game outcomes, such as team score, largest lead, field goal percentage, or whether the team was playing at home.</p>
</section><section id="summary" class="level3" data-number="10.3.6"><h3 data-number="10.3.6" class="anchored" data-anchor-id="summary">
<span class="header-section-number">10.3.6</span> Summary</h3>
<p>Random forests enhance the predictive capabilities of decision trees through ensemble learning and random feature selection. Their accuracy, robustness, interpretability through variable importance measures, and ease of tuning make them indispensable tools in modern sports analytics.</p>


</section></section></main><!-- /main --><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./09_ML.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Introduction to Machine Learning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11_Spatial.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Visualization of Player Tracking Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">STA 3311</div>
  </div>
</footer>


</body></html>